<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>时间管理线性规划可视化系统</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* 基础样式 */
        body { font-family: 'Microsoft YaHei', sans-serif; margin: 0; padding: 0; background: #f5f7fa; color: #333; }
        * { box-sizing: border-box; }
        
        /* 布局结构 */
        .app-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .app-header { background: #1890ff; color: white; padding: 15px 20px; border-radius: 8px 8px 0 0; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .app-header h1 { margin: 0; font-size: 24px; }
        .app-header p { margin: 5px 0 0; opacity: 0.8; font-size: 14px; }
        
        .main-content { display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        
        /* 侧边栏导航 */
        .sidebar { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); overflow: hidden; }
        
        /* 步骤导航 */
        .steps-nav { list-style: none; margin: 0; padding: 0; }
        .step-item { border-bottom: 1px solid #f0f0f0; }
        .step-button { display: flex; align-items: center; padding: 15px 20px; width: 100%; text-align: left; background: none; border: none; cursor: pointer; transition: all 0.3s; }
        .step-button:hover { background: #f5f5f5; }
        .step-button.active { background: #e6f7ff; border-left: 3px solid #1890ff; }
        .step-number { width: 28px; height: 28px; border-radius: 50%; background: #f0f0f0; color: #333; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-weight: bold; }
        .step-button.active .step-number { background: #1890ff; color: white; }
        .step-button.completed .step-number { background: #52c41a; color: white; }
        .step-info { flex: 1; }
        .step-title { font-weight: 500; font-size: 16px; margin-bottom: 3px; }
        .step-desc { font-size: 12px; color: #888; margin: 0; }
        .step-status { margin-left: auto; color: #999; font-size: 12px; }
        .step-button.active .step-status { color: #1890ff; }
        .step-button.completed .step-status { color: #52c41a; }
        
        /* 内容面板 */
        .content-panel { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); overflow: hidden; }
        .panel-header { padding: 15px 20px; background: #fafafa; border-bottom: 1px solid #f0f0f0; }
        .panel-header h2 { margin: 0; font-size: 18px; color: #1890ff; }
        .panel-header p { margin: 5px 0 0; color: #888; font-size: 14px; }
        .panel-body { padding: 20px; }
        
        /* 面板内容区域 */
        .step-content { display: none; }
        .step-content.active { display: block; }
        
        /* 图表区域 */
        .chart-container { height: 450px; margin-top: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); position: relative; }
        #chart { width: 100%; height: 100%; }
        
        /* 控件样式 */
        .control-group { margin-bottom: 20px; }
        .control-group:last-child { margin-bottom: 0; }
        .control-group h3 { margin: 0 0 15px; font-size: 16px; color: #333; display: flex; align-items: center; }
        .control-group h3 .icon { margin-right: 8px; color: #1890ff; }
        
        /* 输入控件 */
        .input-row { display: flex; align-items: center; margin-bottom: 12px; }
        .input-row:last-child { margin-bottom: 0; }
        .input-label { width: 80px; font-weight: 500; font-size: 14px; color: #333; }
        .input-control { flex: 1; display: flex; align-items: center; }
        
        input[type="range"] { 
            appearance: none; 
            height: 6px; 
            background: #e1e1e1; 
            border-radius: 3px; 
            flex: 1; 
            margin: 0; 
            position: relative;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #1890ff;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 5px rgba(24, 144, 255, 0.5);
        }
        
        input[type="number"] {
            width: 60px;
            margin-left: 10px;
            padding: 6px 10px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }
        
        /* 选项卡 */
        .tabs { display: flex; border-bottom: 1px solid #f0f0f0; background: #fafafa; }
        .tab-button { padding: 12px 20px; background: none; border: none; cursor: pointer; font-size: 14px; color: #666; position: relative; transition: all 0.3s; }
        .tab-button:hover { color: #40a9ff; }
        .tab-button.active { color: #1890ff; }
        .tab-button.active::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px; background: #1890ff; }
        
        .tab-content { padding: 20px; display: none; }
        .tab-content.active { display: block; }
        
        /* 按钮样式 */
        .btn-row { display: flex; gap: 10px; margin-top: 20px; }
        .btn { padding: 8px 16px; border-radius: 4px; border: none; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .btn-primary { background: #1890ff; color: white; }
        .btn-primary:hover { background: #40a9ff; }
        .btn-success { background: #52c41a; color: white; }
        .btn-success:hover { background: #73d13d; }
        .btn-danger { background: #ff4d4f; color: white; }
        .btn-danger:hover { background: #ff7875; }
        .btn-secondary { background: #f0f0f0; color: #333; }
        .btn-secondary:hover { background: #d9d9d9; }
        
        /* 卡片样式 */
        .card { background: #f9f9f9; border-radius: 6px; padding: 15px; margin-bottom: 15px; position: relative; overflow: hidden; }
        .card-title { font-weight: 600; margin: 0 0 10px; font-size: 15px; color: #333; }
        .card p { margin: 0 0 8px; font-size: 14px; color: #666; }
        .card p:last-child { margin-bottom: 0; }
        .card.active { background: #e6f7ff; }
        .card.completed { background: #f6ffed; border-left: 3px solid #52c41a; }
        
        /* 图例项目 */
        .legend-item { display: flex; align-items: center; margin-bottom: 8px; }
        .legend-color { width: 14px; height: 14px; border-radius: 50%; margin-right: 8px; }
        .legend-text { font-size: 14px; color: #666; }
        
        /* 活动标签 */
        .activity-tag { display: inline-flex; align-items: center; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; margin-right: 8px; margin-bottom: 8px; }
        .tag-main { background: rgba(24, 144, 255, 0.1); color: #1890ff; }
        .tag-other { background: rgba(82, 196, 26, 0.1); color: #52c41a; }
        .tag-exercise { background: rgba(250, 173, 20, 0.1); color: #faad14; }
        .tag-relax { background: rgba(255, 77, 79, 0.1); color: #ff4d4f; }
        
        /* 时间条样式 */
        .time-bar-container { margin-top: 15px; }
        .time-bar { height: 36px; border-radius: 6px; overflow: hidden; display: flex; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        .time-segment { display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; transition: width 0.5s ease; }
        .segment-main { background: #1890ff; }
        .segment-other { background: #52c41a; }
        .segment-exercise { background: #faad14; }
        .segment-relax { background: #ff4d4f; }
        
        .time-scale { display: flex; justify-content: space-between; margin-top: 5px; font-size: 12px; color: #888; }
        
        /* 加载状态 */
        .loading-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.8); display: flex; align-items: center; justify-content: center; z-index: 100; display: none; }
        .loading-spinner { width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #1890ff; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* 工具提示 */
        .tooltip { position: absolute; background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px; z-index: 1000; pointer-events: none; white-space: nowrap; }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-content { grid-template-columns: 1fr; }
            .chart-container { height: 350px; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 应用标题 -->
        <header class="app-header">
            <h1>时间管理线性规划系统</h1>
            <p>让数学帮你做出最优的时间分配决策</p>
        </header>
        
        <!-- 主要内容区域 -->
        <div class="main-content">
            <!-- 侧边导航 -->
            <aside class="sidebar">
                <ul class="steps-nav">
                    <li class="step-item">
                        <button class="step-button active" onclick="switchStep(1)">
                            <div class="step-number">1</div>
                            <div class="step-info">
                                <div class="step-title">设置约束条件</div>
                                <p class="step-desc">定义学习时间的约束</p>
                            </div>
                            <div class="step-status">进行中</div>
                        </button>
                    </li>
                    <li class="step-item">
                        <button class="step-button" onclick="switchStep(2)">
                            <div class="step-number">2</div>
                            <div class="step-info">
                                <div class="step-title">定义效能系数</div>
                                <p class="step-desc">设置活动的价值权重</p>
                            </div>
                            <div class="step-status">待完成</div>
                        </button>
                    </li>
                    <li class="step-item">
                        <button class="step-button" onclick="switchStep(3)">
                            <div class="step-number">3</div>
                            <div class="step-info">
                                <div class="step-title">探索可行域</div>
                                <p class="step-desc">查看所有可能的时间分配</p>
                            </div>
                            <div class="step-status">待完成</div>
                        </button>
                    </li>
                    <li class="step-item">
                        <button class="step-button" onclick="switchStep(4)">
                            <div class="step-number">4</div>
                            <div class="step-info">
                                <div class="step-title">寻找最优解</div>
                                <p class="step-desc">确定最优时间分配方案</p>
                            </div>
                            <div class="step-status">待完成</div>
                        </button>
                    </li>
                    <li class="step-item">
                        <button class="step-button" onclick="switchStep(5)">
                            <div class="step-number">5</div>
                            <div class="step-info">
                                <div class="step-title">高级探索</div>
                                <p class="step-desc">自定义分析与深入研究</p>
                            </div>
                            <div class="step-status">待完成</div>
                        </button>
                    </li>
                </ul>
                
                <!-- 底部知识点提示 -->
                <div style="padding: 15px; background: #fffbe6; border-top: 1px solid #f0f0f0;">
                    <h3 style="margin: 0 0 10px; font-size: 14px; color: #d48806;">💡 知识点提示</h3>
                    <p style="margin: 0; font-size: 12px; color: #666; line-height: 1.5;">
                        线性规划是研究在约束条件下寻找目标函数最优值的数学方法。在本系统中，我们通过可视化展示如何在有限时间内做出最优分配。
                    </p>
                </div>
            </aside>
            
            <!-- 内容面板 -->
            <main class="content-panel">
                <!-- 步骤1：设置约束条件 -->
                <div class="step-content active" id="step-content-1">
                    <div class="panel-header">
                        <h2>步骤1：设置学习时间约束</h2>
                        <p>设定各科目的最低学习时间要求，总可用时间默认为4小时</p>
                    </div>
                    
                    <div class="panel-body">
                        <div class="card active">
                            <div class="card-title">⏱️ 设置学习时间约束</div>
                            <p>调整以下滑块来设置不同学科的最低学习时间要求：</p>
                            
                            <div class="input-row">
                                <div class="input-label">主科时间:</div>
                                <div class="input-control">
                                    <input type="range" id="mainSubject" min="0.5" max="3" value="1.5" step="0.1" oninput="updateMainSubject(this.value)">
                                    <input type="number" id="mainSubjectInput" min="0.5" max="3" value="1.5" step="0.1" onchange="updateMainSubject(this.value)">
                                    <span style="margin-left: 5px;">小时</span>
                                </div>
                            </div>
                            
                            <div class="input-row">
                                <div class="input-label">综合科目:</div>
                                <div class="input-control">
                                    <input type="range" id="otherSubject" min="0.5" max="3" value="1" step="0.1" oninput="updateOtherSubject(this.value)">
                                    <input type="number" id="otherSubjectInput" min="0.5" max="3" value="1" step="0.1" onchange="updateOtherSubject(this.value)">
                                    <span style="margin-left: 5px;">小时</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-title">📌 固定活动时间</div>
                            <p>以下活动时间为固定值，不可调整：</p>
                            
                            <div style="display: flex; flex-wrap: wrap; margin-top: 10px;">
                                <div class="activity-tag tag-exercise">
                                    <span style="width: 8px; height: 8px; border-radius: 50%; background: #faad14; margin-right: 5px;"></span>
                                    运动解压: 0.5小时
                                </div>
                                <div class="activity-tag tag-relax">
                                    <span style="width: 8px; height: 8px; border-radius: 50%; background: #ff4d4f; margin-right: 5px;"></span>
                                    充电放松: 0.5小时
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-title">🔍 约束条件说明</div>
                            <div style="margin-top: 10px;">
                                <div class="legend-item">
                                    <div class="legend-color" style="background: #ff4d4f;"></div>
                                    <div class="legend-text">总时间约束: x + y + 1 ≤ 4（即x + y ≤ 3）</div>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background: #1890ff;"></div>
                                    <div class="legend-text">主科时间下限: x ≥ <span id="main-min-value">1.5</span></div>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background: #52c41a;"></div>
                                    <div class="legend-text">综合科目下限: y ≥ <span id="other-min-value">1</span></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 图表容器 -->
                        <div class="chart-container">
                            <div id="chart"></div>
                            <div class="loading-overlay" id="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                        </div>
                        
                        <!-- 下一步按钮 -->
                        <div class="btn-row">
                            <button class="btn btn-secondary" disabled>上一步</button>
                            <button class="btn btn-primary" onclick="nextStep()">下一步</button>
                        </div>
                    </div>
                </div>
                
                <!-- 步骤2：定义效能系数 -->
                <div class="step-content" id="step-content-2">
                    <div class="panel-header">
                        <h2>步骤2：定义效能系数</h2>
                        <p>设置各类活动的价值权重，影响最终的最优解</p>
                    </div>
                    
                    <div class="panel-body">
                        <div class="card active">
                            <div class="card-title">🎯 设置活动效能系数</div>
                            <p>根据个人偏好，为每种活动设置1-10分的效能系数：</p>
                            
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                                <div style="background: #f0f7ff; padding: 12px; border-radius: 6px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #1890ff; margin-right: 8px;"></div>
                                        <span style="font-weight: 500; flex: 1;">主科冲刺</span>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <input type="range" id="mainCoeff" min="1" max="10" value="9" step="1" style="flex: 1;" oninput="updateCoefficients()">
                                        <input type="number" id="mainCoeffInput" min="1" max="10" value="9" style="width: 50px; margin-left: 10px;" onchange="updateCoefficients()">
                                    </div>
                                </div>
                                
                                <div style="background: #f0fff7; padding: 12px; border-radius: 6px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #52c41a; margin-right: 8px;"></div>
                                        <span style="font-weight: 500; flex: 1;">综合科目</span>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <input type="range" id="otherCoeff" min="1" max="10" value="7" step="1" style="flex: 1;" oninput="updateCoefficients()">
                                        <input type="number" id="otherCoeffInput" min="1" max="10" value="7" style="width: 50px; margin-left: 10px;" onchange="updateCoefficients()">
                                    </div>
                                </div>
                                
                                <div style="background: #fffaf0; padding: 12px; border-radius: 6px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #faad14; margin-right: 8px;"></div>
                                        <span style="font-weight: 500; flex: 1;">运动解压</span>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <input type="range" id="exerciseCoeff" min="1" max="10" value="6" step="1" style="flex: 1;" oninput="updateCoefficients()">
                                        <input type="number" id="exerciseCoeffInput" min="1" max="10" value="6" style="width: 50px; margin-left: 10px;" onchange="updateCoefficients()">
                                    </div>
                                </div>
                                
                                <div style="background: #fff0f0; padding: 12px; border-radius: 6px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #ff4d4f; margin-right: 8px;"></div>
                                        <span style="font-weight: 500; flex: 1;">充电放松</span>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <input type="range" id="relaxCoeff" min="1" max="10" value="5" step="1" style="flex: 1;" oninput="updateCoefficients()">
                                        <input type="number" id="relaxCoeffInput" min="1" max="10" value="5" style="width: 50px; margin-left: 10px;" onchange="updateCoefficients()">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-title">🧮 目标函数计算</div>
                            <p>根据所设定的系数，目标函数将被表示为：</p>
                            
                            <div style="background: #f9f9f9; padding: 12px; border-radius: 6px; margin-top: 10px; font-family: 'Courier New', monospace; text-align: center;">
                                <span style="font-size: 16px;" id="objective-function">
                                    最大化 Z = ${mainCoeff}x + ${otherCoeff}y + ${exerciseCoeff}(0.5) + ${relaxCoeff}(0.5) = ${mainCoeff}x + ${otherCoeff}y + ${fixedValue}`;
                                </span>
                            </div>
                            
                            <div style="margin-top: 15px; font-size: 14px; color: #666;">
                                <p><b>系数含义</b>：系数越高，表示该活动越重要或价值越大</p>
                                <p><b>提示</b>：根据你当前的学习状态和目标，调整不同活动的系数</p>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-title">📊 效能分析</div>
                            <p>各活动每小时产生的效益对比：</p>
                            
                            <div style="display: flex; align-items: flex-end; height: 150px; gap: 15px; margin-top: 15px; padding: 0 20px;">
                                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                                    <div style="background: #1890ff; width: 40px; border-radius: 4px 4px 0 0;" id="main-bar">
                                        <div style="height: 90px;"></div>
                                    </div>
                                    <div style="margin-top: 8px; font-size: 12px; text-align: center;">主科冲刺</div>
                                    <div style="font-weight: 500; font-size: 14px;" id="main-value">9分/小时</div>
                                </div>
                                
                                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                                    <div style="background: #52c41a; width: 40px; border-radius: 4px 4px 0 0;" id="other-bar">
                                        <div style="height: 70px;"></div>
                                    </div>
                                    <div style="margin-top: 8px; font-size: 12px; text-align: center;">综合科目</div>
                                    <div style="font-weight: 500; font-size: 14px;" id="other-value">7分/小时</div>
                                </div>
                                
                                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                                    <div style="background: #faad14; width: 40px; border-radius: 4px 4px 0 0;" id="exercise-bar">
                                        <div style="height: 60px;"></div>
                                    </div>
                                    <div style="margin-top: 8px; font-size: 12px; text-align: center;">运动解压</div>
                                    <div style="font-weight: 500; font-size: 14px;" id="exercise-value">6分/小时</div>
                                </div>
                                
                                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                                    <div style="background: #ff4d4f; width: 40px; border-radius: 4px 4px 0 0;" id="relax-bar">
                                        <div style="height: 50px;"></div>
                                    </div>
                                    <div style="margin-top: 8px; font-size: 12px; text-align: center;">充电放松</div>
                                    <div style="font-weight: 500; font-size: 14px;" id="relax-value">5分/小时</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 图表容器 -->
                        <div class="chart-container">
                            <div id="chart"></div>
                            <div class="loading-overlay" id="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                        </div>
                        
                        <!-- 导航按钮 -->
                        <div class="btn-row">
                            <button class="btn btn-secondary" onclick="prevStep()">上一步</button>
                            <button class="btn btn-primary" onclick="nextStep()">下一步</button>
                        </div>
                    </div>
                </div>
                
                <!-- 步骤3：探索可行域 -->
                <div class="step-content" id="step-content-3">
                    <div class="panel-header">
                        <h2>步骤3：探索可行域</h2>
                        <p>查看所有满足约束条件的可能时间分配方案</p>
                    </div>
                    
                    <div class="panel-body">
                        <div class="card active">
                            <div class="card-title">🧭 可行域探索</div>
                            <p>可行域是满足所有约束条件的区域（绿色区域）。顶点是找出最优解的关键点。</p>
                            
                            <div style="margin-top: 15px; display: flex; gap: 10px;">
                                <button class="btn btn-primary" id="vertexBtn" onclick="toggleVertex()">
                                    <span id="vertex-btn-text">显示顶点坐标</span>
                                </button>
                                <button class="btn btn-secondary" onclick="autoZoom()">
                                    智能缩放视图
                                </button>
                                <button class="btn btn-secondary" onclick="resetZoom()">
                                    重置视图
                                </button>
                            </div>
                        </div>
                        
                        <div class="card" id="feasible-region-card">
                            <div class="card-title">📐 可行域分析</div>
                            <p>根据你设置的约束条件，当前图中的绿色区域是所有可能的时间分配方案：</p>
                            
                            <div style="background: #f5f5f5; border-radius: 6px; padding: 15px; margin-top: 15px;">
                                <div id="no-vertices-message" style="display: none; color: #ff4d4f; text-align: center; padding: 10px;">
                                    <svg viewBox="64 64 896 896" focusable="false" data-icon="warning" width="16px" height="16px" fill="currentColor" aria-hidden="true"><path d="M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"></path></svg>
                                    <span style="margin-left: 8px; vertical-align: middle;">当前约束条件下没有可行解，请调整约束条件</span>
                                </div>
                                
                                <div id="vertices-list" style="display: none;">
                                    <p style="font-weight: 500; margin-bottom: 10px;">可行域顶点坐标：</p>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;" id="vertices-grid">
                                        <!-- 顶点将在JavaScript中动态添加 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-title">🔑 关键概念</div>
                            <p>线性规划的关键原理是：<b>最优解总是出现在可行域的顶点上</b>。</p>
                            
                            <div style="display: flex; gap: 15px; margin-top: 15px;">
                                <div style="flex: 1; padding: 12px; background: #f0f5ff; border-radius: 6px;">
                                    <div style="font-weight: 500; margin-bottom: 5px; color: #1890ff;">约束线</div>
                                    <p style="font-size: 13px; margin: 0;">约束条件在坐标系中表示为直线，这些直线的交点形成可行域的顶点</p>
                                </div>
                                <div style="flex: 1; padding: 12px; background: #f0f5ff; border-radius: 6px;">
                                    <div style="font-weight: 500; margin-bottom: 5px; color: #1890ff;">可行解</div>
                                    <p style="font-size: 13px; margin: 0;">可行域内的任意点都是满足约束条件的可行解，但最优解在顶点</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 图表容器 -->
                        <div class="chart-container">
                            <div id="chart"></div>
                            <div class="loading-overlay" id="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                        </div>
                        
                        <!-- 导航按钮 -->
                        <div class="btn-row">
                            <button class="btn btn-secondary" onclick="prevStep()">上一步</button>
                            <button class="btn btn-primary" onclick="nextStep()">下一步</button>
                        </div>
                    </div>
                </div>
                
                <!-- 步骤4：寻找最优解 -->
                <div class="step-content" id="step-content-4">
                    <div class="panel-header">
                        <h2>步骤4：寻找最优解</h2>
                        <p>确定最优时间分配方案</p>
                    </div>
                    
                    <div class="panel-body">
                        <div class="card active">
                            <div class="card-title">🎯 最优解分析</div>
                            <p>根据目标函数：Z = <span id="optimal-function-text">9x + 7y + 5.5</span>，在约束条件下的最优解为：</p>
                            
                            <div id="optimal-solution-card" style="background: #f6ffed; border: 1px solid #b7eb8f; border-radius: 6px; padding: 15px; margin-top: 15px; display: none;">
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="background: #52c41a; color: white; padding: 8px; border-radius: 50%; margin-right: 12px; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px;">
                                        <svg viewBox="64 64 896 896" focusable="false" data-icon="check" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"></path></svg>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; margin-bottom: 8px; color: #333; font-size: 16px;">最优解坐标</div>
                                        <div style="display: flex; margin-bottom: 8px;">
                                            <div style="flex: 1; padding-right: 10px;">
                                                <div style="font-size: 13px; color: #666; margin-bottom: 3px;">主科时间 (x):</div>
                                                <div style="font-weight: 500; color: #1890ff; font-size: 16px;" id="optimal-x">0.0</div>
                                            </div>
                                            <div style="flex: 1; padding-right: 10px;">
                                                <div style="font-size: 13px; color: #666; margin-bottom: 3px;">综合科目 (y):</div>
                                                <div style="font-weight: 500; color: #52c41a; font-size: 16px;" id="optimal-y">0.0</div>
                                            </div>
                                            <div style="flex: 1;">
                                                <div style="font-size: 13px; color: #666; margin-bottom: 3px;">总效益值:</div>
                                                <div style="font-weight: 500; color: #722ed1; font-size: 16px;" id="optimal-value">0.0</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="no-solution-message" style="display: none; background: #fff2f0; border: 1px solid #ffccc7; border-radius: 6px; padding: 15px; margin-top: 15px;">
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="background: #ff4d4f; color: white; padding: 8px; border-radius: 50%; margin-right: 12px; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px;">
                                        <svg viewBox="64 64 896 896" focusable="false" data-icon="close" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 00203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z"></path></svg>
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 8px; color: #333; font-size: 16px;">无可行解</div>
                                        <div style="font-size: 14px; color: #666; line-height: 1.5;">
                                            当前约束条件下没有可行的解，请调整约束条件。常见原因是主科和综合科目的最低时间要求总和超过了最大可用时间。
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card" id="time-allocation-card" style="display: none;">
                            <div class="card-title">⏱️ 最优时间分配</div>
                            <p>根据最优解，最佳的时间分配方案如下（总时间：<span id="total-time-value">4.0</span>小时）：</p>
                            
                            <div class="time-bar-container">
                                <div class="time-bar">
                                    <div class="time-segment segment-main"></div>
                                    <div class="time-segment segment-other"></div>
                                    <div class="time-segment segment-exercise"></div>
                                    <div class="time-segment segment-relax"></div>
                                </div>
                                <div class="time-scale">
                                    <span>0h</span>
                                    <span>1h</span>
                                    <span>2h</span>
                                    <span>3h</span>
                                    <span>4h</span>
                                </div>
                            </div>
                            
                            <div style="display: flex; margin-top: 20px; gap: 15px;">
                                <div style="flex: 1; background: #f0f7ff; padding: 12px; border-radius: 6px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #1890ff; margin-right: 8px;"></div>
                                        <span style="font-weight: 500; flex: 1;">主科冲刺</span>
                                    </div>
                                    <div style="font-weight: 500; font-size: 14px; color: #1890ff;" id="main-time-value">0.0小时</div>
                                </div>
                                
                                <div style="flex: 1; background: #f0fff7; padding: 12px; border-radius: 6px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #52c41a; margin-right: 8px;"></div>
                                        <span style="font-weight: 500; flex: 1;">综合科目</span>
                                    </div>
                                    <div style="font-weight: 500; font-size: 14px; color: #52c41a;" id="other-time-value">0.0小时</div>
                                </div>
                                
                                <div style="flex: 1; background: #fffaf0; padding: 12px; border-radius: 6px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #faad14; margin-right: 8px;"></div>
                                        <span style="font-weight: 500; flex: 1;">运动解压</span>
                                    </div>
                                    <div style="font-weight: 500; font-size: 14px; color: #faad14;">0.5小时</div>
                                </div>
                                
                                <div style="flex: 1; background: #fff0f0; padding: 12px; border-radius: 6px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #ff4d4f; margin-right: 8px;"></div>
                                        <span style="font-weight: 500; flex: 1;">充电放松</span>
                                    </div>
                                    <div style="font-weight: 500; font-size: 14px; color: #ff4d4f;">0.5小时</div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px; background: #f9f0ff; padding: 12px; border-radius: 6px;">
                                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <div style="width: 12px; height: 12px; border-radius: 50%; background: #722ed1; margin-right: 8px;"></div>
                                    <span style="font-weight: 500;">总效益值</span>
                                </div>
                                <div style="font-weight: 600; font-size: 16px; color: #722ed1;">
                                    <span id="total-value">0.0</span> 分
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-title">🔍 约束条件回顾</div>
                            <p>计算最优解时考虑了以下约束条件：</p>
                            
                            <div style="margin-top: 10px;">
                                <div class="legend-item">
                                    <div class="legend-color" style="background: #ff4d4f;"></div>
                                    <div class="legend-text">总时间约束: x + y + 1 ≤ 4（即x + y ≤ 3）</div>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background: #1890ff;"></div>
                                    <div class="legend-text">主科时间下限: x ≥ <span id="main-min-value">1.5</span></div>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background: #52c41a;"></div>
                                    <div class="legend-text">综合科目下限: y ≥ <span id="other-min-value">1</span></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 图表容器 -->
                        <div class="chart-container">
                            <div id="chart"></div>
                            <div class="loading-overlay" id="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                        </div>
                        
                        <!-- 导航按钮 -->
                        <div class="btn-row">
                            <button class="btn btn-secondary" onclick="prevStep()">上一步</button>
                            <button class="btn btn-primary" onclick="nextStep()">下一步</button>
                        </div>
                    </div>
                </div>
                
                <!-- 步骤5：高级探索 -->
                <div class="step-content" id="step-content-5">
                    <div class="panel-header">
                        <h2>步骤5：高级探索</h2>
                        <p>灵活调整参数，深入理解线性规划</p>
                    </div>
                    
                    <div class="panel-body">
                        <div class="tabs">
                            <button class="tab-button active" onclick="switchTab('sensitivity')">敏感性分析</button>
                            <button class="tab-button" onclick="switchTab('custom')">自定义探索</button>
                            <button class="tab-button" onclick="switchTab('compare')">方案对比</button>
                        </div>
                        
                        <!-- 敏感性分析 -->
                        <div class="tab-content active" id="tab-sensitivity">
                            <div class="card">
                                <div class="card-title">📊 效能系数敏感性分析</div>
                                <p>探索改变效能系数对最优解的影响。拖动滑块调整系数，查看最优解的变化：</p>
                                
                                <div style="margin-top: 15px;">
                                    <div style="margin-bottom: 15px;">
                                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                            <div style="width: 12px; height: 12px; border-radius: 50%; background: #1890ff; margin-right: 8px;"></div>
                                            <span style="font-weight: 500;">主科效能系数</span>
                                            <span style="margin-left: auto; font-weight: 500; color: #1890ff;" id="main-sensitivity-value">9</span>
                                        </div>
                                        <input type="range" min="1" max="20" value="9" step="1" style="width: 100%;" oninput="updateSensitivity('main', this.value)">
                                    </div>
                                    
                                    <div style="margin-bottom: 15px;">
                                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                            <div style="width: 12px; height: 12px; border-radius: 50%; background: #52c41a; margin-right: 8px;"></div>
                                            <span style="font-weight: 500;">综合科目效能系数</span>
                                            <span style="margin-left: auto; font-weight: 500; color: #52c41a;" id="other-sensitivity-value">7</span>
                                        </div>
                                        <input type="range" min="1" max="20" value="7" step="1" style="width: 100%;" oninput="updateSensitivity('other', this.value)">
                                    </div>
                                </div>
                                
                                <div style="margin-top: 15px; background: #f0f5ff; border-radius: 6px; padding: 15px;">
                                    <div style="font-weight: 500; margin-bottom: 8px;">敏感性分析结果</div>
                                    <div style="font-size: 14px; color: #666; line-height: 1.5;" id="sensitivity-result">
                                        调整效能系数来查看最优解的变化...
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-title">🧮 参数临界值分析</div>
                                <p>探索效能系数的临界值，在这些值附近最优解会发生跳变：</p>
                                
                                <div style="margin-top: 15px; background: #f9f0ff; border-radius: 6px; padding: 15px;">
                                    <div style="font-weight: 500; margin-bottom: 8px;">参数临界值</div>
                                    <div id="critical-values">
                                        <p>当主科/综合科目效能系数比值在临界点变化时，最优解会发生变化。</p>
                                        <ul style="padding-left: 20px; margin-top: 10px;">
                                            <li style="margin-bottom: 5px;">如果 主科系数/综合系数 > 1，最优解优先分配更多时间给主科</li>
                                            <li style="margin-bottom: 5px;">如果 主科系数/综合系数 < 1，最优解优先分配更多时间给综合科目</li>
                                            <li>如果 主科系数/综合系数 = 1，则多个顶点具有相同的最优值</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 自定义探索 -->
                        <div class="tab-content" id="tab-custom">
                            <div class="card">
                                <div class="card-title">🔄 调整总时间限制</div>
                                <p>探索改变总可用时间对最优解的影响：</p>
                                
                                <div style="margin-top: 15px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <span style="font-weight: 500;">总可用时间</span>
                                        <span style="margin-left: auto; font-weight: 500; color: #1890ff;" id="total-time-custom-value">4.0</span>
                                        <span style="margin-left: 5px;">小时</span>
                                    </div>
                                    <input type="range" min="2" max="8" value="4" step="0.5" style="width: 100%;" oninput="updateTotalTime(this.value)">
                                </div>
                                
                                <div style="margin-top: 15px;">
                                    <button class="btn btn-primary" onclick="updateCustomExploration()">
                                        应用更改
                                    </button>
                                    <button class="btn btn-secondary" style="margin-left: 10px;" onclick="resetCustomExploration()">
                                        重置默认值
                                    </button>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-title">📐 调整约束下限</div>
                                <p>探索改变最低学习时间要求对最优解的影响：</p>
                                
                                <div style="margin-top: 15px;">
                                    <div class="input-row">
                                        <div class="input-label">主科下限:</div>
                                        <div class="input-control">
                                            <input type="range" id="mainSubjectCustom" min="0" max="3" value="1.5" step="0.1" oninput="updateMainSubjectCustom(this.value)">
                                            <input type="number" id="mainSubjectCustomInput" min="0" max="3" value="1.5" step="0.1" style="width: 60px;" onchange="updateMainSubjectCustom(this.value)">
                                            <span style="margin-left: 5px;">小时</span>
                                        </div>
                                    </div>
                                    
                                    <div class="input-row">
                                        <div class="input-label">综合下限:</div>
                                        <div class="input-control">
                                            <input type="range" id="otherSubjectCustom" min="0" max="3" value="1" step="0.1" oninput="updateOtherSubjectCustom(this.value)">
                                            <input type="number" id="otherSubjectCustomInput" min="0" max="3" value="1" step="0.1" style="width: 60px;" onchange="updateOtherSubjectCustom(this.value)">
                                            <span style="margin-left: 5px;">小时</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 15px;">
                                    <button class="btn btn-primary" onclick="updateCustomExploration()">
                                        应用更改
                                    </button>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-title">💡 探索发现</div>
                                <div style="margin-top: 15px; background: #f0f5ff; border-radius: 6px; padding: 15px;">
                                    <div id="custom-exploration-result">
                                        <p>线性规划的关键发现：</p>
                                        <ul style="padding-left: 20px; margin-top: 10px;">
                                            <li>增加总时间通常会提高总效益，但最优分配比例可能保持不变</li>
                                            <li>如果某个约束条件不再起作用（非紧约束），最优解可能不会改变</li>
                                            <li>当一个约束变得更严格时，总效益通常会降低</li>
                                            <li>最优解总是出现在可行域的顶点上</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 方案对比 -->
                        <div class="tab-content" id="tab-compare">
                            <div class="card">
                                <div class="card-title">🔄 方案对比分析</div>
                                <p>比较不同时间分配方案的效益差异：</p>
                                
                                <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                                    <div style="background: #f0f5ff; padding: 15px; border-radius: 6px;">
                                        <div style="font-weight: 500; margin-bottom: 10px; display: flex; align-items: center;">
                                            <span style="width: 20px; height: 20px; background: #1890ff; border-radius: 50%; margin-right: 8px;"></span>
                                            最优方案
                                        </div>
                                        <div style="margin-top: 10px;">
                                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                                <div style="color: #666;">主科时间:</div>
                                                <div style="font-weight: 500;" id="optimal-x-compare">0.0小时</div>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                                <div style="color: #666;">综合科目:</div>
                                                <div style="font-weight: 500;" id="optimal-y-compare">0.0小时</div>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                                <div style="color: #666;">固定活动:</div>
                                                <div style="font-weight: 500;">1.0小时</div>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding-top: 5px; border-top: 1px dashed #ccc; margin-top: 5px;">
                                                <div style="color: #666;">总效益值:</div>
                                                <div style="font-weight: 600; color: #1890ff;" id="optimal-value-compare">0.0</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style="background: #f6ffed; padding: 15px; border-radius: 6px;">
                                        <div style="font-weight: 500; margin-bottom: 10px; display: flex; align-items: center;">
                                            <span style="width: 20px; height: 20px; background: #52c41a; border-radius: 50%; margin-right: 8px;"></span>
                                            平均方案
                                        </div>
                                        <div style="margin-top: 10px;">
                                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                                <div style="color: #666;">主科时间:</div>
                                                <div style="font-weight: 500;" id="average-x-compare">1.5小时</div>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                                <div style="color: #666;">综合科目:</div>
                                                <div style="font-weight: 500;" id="average-y-compare">1.5小时</div>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                                <div style="color: #666;">固定活动:</div>
                                                <div style="font-weight: 500;">1.0小时</div>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; padding-top: 5px; border-top: 1px dashed #ccc; margin-top: 5px;">
                                                <div style="color: #666;">总效益值:</div>
                                                <div style="font-weight: 600; color: #52c41a;" id="average-value-compare">0.0</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 添加统计图表容器 -->
                                <div style="margin-top: 20px; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 15px;">
                                    <div style="font-weight: 500; margin-bottom: 15px; color: #333; text-align: center;">
                                        方案效益统计图表
                                    </div>
                                    <div id="statistics-chart" style="width: 100%; height: 250px;"></div>
                                </div>
                                
                                <div style="margin-top: 15px; background: #f9f0ff; border-radius: 6px; padding: 15px;">
                                    <div style="font-weight: 500; margin-bottom: 8px;">效益差异分析</div>
                                    <div id="compare-result" style="font-size: 14px; color: #666; line-height: 1.5;">
                                        通过线性规划找到的最优解比平均分配方案可以提高 <span id="improvement-percentage" style="color: #722ed1; font-weight: 600;">0%</span> 的总效益值。这说明了数学方法在资源优化配置中的重要性。
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-title">💡 思考与启示</div>
                                <div style="margin-top: 15px; background: #f0f5ff; border-radius: 6px; padding: 15px;">
                                    <div id="comparison-insights">
                                        <p>从时间管理最优化中可以获得的启示：</p>
                                        <ul style="padding-left: 20px; margin-top: 10px;">
                                            <li>科学的时间管理可以显著提升学习效率</li>
                                            <li>应根据个人能力和科目重要性设置合理的效能系数</li>
                                            <li>固定的休息和运动时间对整体效益有积极影响</li>
                                            <li>最优解告诉我们要重点投入到效益系数高的活动上</li>
                                            <li>数学方法能帮助我们做出更明智的决策</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 图表容器 -->
                        <div class="chart-container">
                            <div id="chart"></div>
                            <div class="loading-overlay" id="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                        </div>
                        
                        <!-- 导航按钮 -->
                        <div class="btn-row">
                            <button class="btn btn-secondary" onclick="prevStep()">上一步</button>
                            <button class="btn btn-success">完成学习</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- JavaScript 代码 -->
    <script>
        // 全局变量
        let myChart = null;
        let animationTimer = null;
        let animationSteps = [];
        let currentStep = 0;
        let showVertices = false;
        let currentActiveStep = 1;
        let customZoom = false;
        let zoomFactor = { x: 1.3, y: 1.3 };
        let totalTime = 4; // 默认总时间为4小时
        
        // 活动系数
        let coefficients = {
            main: 9,     // 主科冲刺
            other: 7,    // 综合科目
            exercise: 6, // 运动解压
            relax: 5     // 充电放松
        };
        
        // 固定时间活动
        const fixedActivities = {
            exercise: 0.5, // 运动解压
            relax: 0.5     // 充电放松
        };
        
        // ============== 安全初始化图表 ==============
        function initChart() {
            try {
                // 检查chart元素是否存在
                const chartElement = document.getElementById('chart');
                if (!chartElement) {
                    console.error("无法找到ID为'chart'的DOM元素");
                    return false;
                }
                
                // 如果已存在图表实例，先销毁
                if (myChart && myChart.dispose) {
                    myChart.dispose();
                    myChart = null;
                }
                
                // 检查ECharts库是否正确加载
                if (typeof echarts === 'undefined') {
                    console.error("ECharts库未加载，请检查网络连接或脚本引用");
                    return false;
                }
                
                // 创建新图表实例
                myChart = echarts.init(chartElement);
                
                // 测试图表是否正确初始化
                if (!myChart || !myChart.setOption) {
                    console.error("图表初始化失败，echarts.init返回的对象无效");
                    return false;
                }
                
                // 设置一个简单的测试图表，确保图表可以正常工作
                try {
                    myChart.setOption({
                        xAxis: { type: 'value', min: 0, max: 1 },
                        yAxis: { type: 'value', min: 0, max: 1 },
                        series: [{ type: 'scatter', data: [[0.5, 0.5]] }]
                    });
                } catch (e) {
                    console.error("测试图表设置失败:", e);
                    return false;
                }
                
                // 注册窗口大小改变事件
                window.addEventListener('resize', function() {
                    if (myChart) {
                        try {
                            myChart.resize();
                        } catch (e) {
                            console.error("图表大小调整失败:", e);
                        }
                    }
                });
                
                return true;
            } catch (e) {
                console.error("图表初始化过程发生错误:", e);
                return false;
            }
        }
        
        // ============== 更新UI ==============
        function updateUI() {
            document.getElementById('loading-overlay').style.display = 'flex';
            
            // 延迟执行以确保UI更新
            setTimeout(() => {
                try {
                    // 同步输入框和滑块值
                    syncInputValues();
                    
                    // 更新图表
                    try {
                        renderChart();
                    } catch (e) {
                        console.error("渲染图表错误:", e);
                    }
                    
                    // 更新公式显示
                    if (document.getElementById('objective-function')) {
                        updateObjectiveFunction();
                    }
                    
                    // 如果当前在步骤3并且显示顶点，则更新顶点列表
                    if (currentActiveStep === 3 && showVertices && document.getElementById('vertices-list')) {
                        updateVerticesList();
                    }
                    
                    // 如果当前在步骤4，则更新最优解显示
                    if (currentActiveStep === 4) {
                        try {
                            updateOptimalSolutionDisplay();
                        } catch (e) {
                            console.error("更新最优解显示错误:", e);
                        }
                    }
                    
                    // 如果当前在步骤5，则更新各种高级探索数据
                    if (currentActiveStep === 5) {
                        try {
                            // 完全禁止自动调用 updateComparisonData
                            // 只在用户主动切换到比较标签页时才会调用
                            if (document.getElementById('main-sensitivity-value')) {
                                updateSensitivity('main', document.getElementById('main-sensitivity-value').textContent);
                            }
                        } catch (e) {
                            console.error("更新敏感性分析错误:", e);
                        }
                    }
                } catch (e) {
                    console.error("更新UI错误:", e);
                } finally {
                    document.getElementById('loading-overlay').style.display = 'none';
                }
            }, 50);
        }
        
        // ============== 更新公式显示 ==============
        function updateObjectiveFunction() {
            const mainCoeff = coefficients.main;
            const otherCoeff = coefficients.other;
            const exerciseCoeff = coefficients.exercise;
            const relaxCoeff = coefficients.relax;
            
            const fixedValue = exerciseCoeff * fixedActivities.exercise + relaxCoeff * fixedActivities.relax;
            
            document.getElementById('objective-function').textContent = 
                `最大化 Z = ${mainCoeff}x + ${otherCoeff}y + ${exerciseCoeff}(0.5) + ${relaxCoeff}(0.5) = ${mainCoeff}x + ${otherCoeff}y + ${fixedValue}`;
        }
        
        // ============== 更新效能系数柱状图 ==============
        function updateEfficiencyBars() {
            // 获取最大值来标准化高度
            const maxCoeff = Math.max(
                coefficients.main,
                coefficients.other,
                coefficients.exercise,
                coefficients.relax
            );
            
            // 设置柱状图高度
            document.querySelector('#main-bar div').style.height = `${(coefficients.main / maxCoeff) * 100}px`;
            document.querySelector('#other-bar div').style.height = `${(coefficients.other / maxCoeff) * 100}px`;
            document.querySelector('#exercise-bar div').style.height = `${(coefficients.exercise / maxCoeff) * 100}px`;
            document.querySelector('#relax-bar div').style.height = `${(coefficients.relax / maxCoeff) * 100}px`;
            
            // 更新分值文本
            document.getElementById('main-value').textContent = `${coefficients.main}分/小时`;
            document.getElementById('other-value').textContent = `${coefficients.other}分/小时`;
            document.getElementById('exercise-value').textContent = `${coefficients.exercise}分/小时`;
            document.getElementById('relax-value').textContent = `${coefficients.relax}分/小时`;
        }
        
        // ============== 同步输入值 ==============
        function syncInputValues() {
            // 同步约束值
            const mainSubjectInput = document.getElementById('mainSubjectInput');
            const otherSubjectInput = document.getElementById('otherSubjectInput');
            if (mainSubjectInput && document.getElementById('mainSubject')) {
                mainSubjectInput.value = document.getElementById('mainSubject').value;
            }
            if (otherSubjectInput && document.getElementById('otherSubject')) {
                otherSubjectInput.value = document.getElementById('otherSubject').value;
            }
            
            // 同步系数值
            if (document.getElementById('mainCoeffInput') && document.getElementById('mainCoeff')) {
                document.getElementById('mainCoeffInput').value = document.getElementById('mainCoeff').value;
            }
            if (document.getElementById('otherCoeffInput') && document.getElementById('otherCoeff')) {
                document.getElementById('otherCoeffInput').value = document.getElementById('otherCoeff').value;
            }
            if (document.getElementById('exerciseCoeffInput') && document.getElementById('exerciseCoeff')) {
                document.getElementById('exerciseCoeffInput').value = document.getElementById('exerciseCoeff').value;
            }
            if (document.getElementById('relaxCoeffInput') && document.getElementById('relaxCoeff')) {
                document.getElementById('relaxCoeffInput').value = document.getElementById('relaxCoeff').value;
            }
        }
        
        // ============== 更新主科最低时间 ==============
        function updateMainSubject(value) {
            const mainSubject = parseFloat(value);
            
            // 更新UI元素
            if (document.getElementById('mainSubject')) {
                document.getElementById('mainSubject').value = mainSubject;
            }
            if (document.getElementById('mainSubjectInput')) {
                document.getElementById('mainSubjectInput').value = mainSubject;
            }
            
            // 更新最低值显示
            updateMainMinValue(mainSubject);
            
            // 更新UI
            updateUI();
        }
        
        // ============== 更新综合科目最低时间 ==============
        function updateOtherSubject(value) {
            const otherSubject = parseFloat(value);
            
            // 更新UI元素
            if (document.getElementById('otherSubject')) {
                document.getElementById('otherSubject').value = otherSubject;
            }
            if (document.getElementById('otherSubjectInput')) {
                document.getElementById('otherSubjectInput').value = otherSubject;
            }
            
            // 更新最低值显示
            updateOtherMinValue(otherSubject);
            
            // 更新UI
            updateUI();
        }
        
        // ============== 更新主科最低值显示 ==============
        function updateMainMinValue(value) {
            const elements = document.querySelectorAll('#main-min-value');
            elements.forEach(el => { el.textContent = value; });
        }
        
        // ============== 更新综合科目最低值显示 ==============
        function updateOtherMinValue(value) {
            const elements = document.querySelectorAll('#other-min-value');
            elements.forEach(el => { el.textContent = value; });
        }
        
        // ============== 更新系数 ==============
        function updateCoefficients() {
            // 从输入框获取系数
            if (document.getElementById('mainCoeff')) {
                coefficients.main = parseInt(document.getElementById('mainCoeff').value) || 9;
            } else if (document.getElementById('mainCoeffInput')) {
                coefficients.main = parseInt(document.getElementById('mainCoeffInput').value) || 9;
            }
            
            if (document.getElementById('otherCoeff')) {
                coefficients.other = parseInt(document.getElementById('otherCoeff').value) || 7;
            } else if (document.getElementById('otherCoeffInput')) {
                coefficients.other = parseInt(document.getElementById('otherCoeffInput').value) || 7;
            }
            
            if (document.getElementById('exerciseCoeff')) {
                coefficients.exercise = parseInt(document.getElementById('exerciseCoeff').value) || 6;
            } else if (document.getElementById('exerciseCoeffInput')) {
                coefficients.exercise = parseInt(document.getElementById('exerciseCoeffInput').value) || 6;
            }
            
            if (document.getElementById('relaxCoeff')) {
                coefficients.relax = parseInt(document.getElementById('relaxCoeff').value) || 5;
            } else if (document.getElementById('relaxCoeffInput')) {
                coefficients.relax = parseInt(document.getElementById('relaxCoeffInput').value) || 5;
            }
            
            // 确保系数在1-10的范围内
            coefficients.main = Math.max(1, Math.min(10, coefficients.main));
            coefficients.other = Math.max(1, Math.min(10, coefficients.other));
            coefficients.exercise = Math.max(1, Math.min(10, coefficients.exercise));
            coefficients.relax = Math.max(1, Math.min(10, coefficients.relax));
            
            // 同步输入值
            syncInputValues();
            
            // 更新效能系数图表
            updateEfficiencyBars();
            
            // 更新公式显示
            updateObjectiveFunction();
            
            // 更新UI
            updateUI();
        }
        
        // ============== 获取当前约束条件 ==============
        function getConstraints() {
            // 获取主科和综合科目的最低学习时间
            const mainMinTime = parseFloat(document.getElementById('mainSubject').value);
            const otherMinTime = parseFloat(document.getElementById('otherSubject').value);
            
            return {
                mainMinTime,
                otherMinTime,
                totalTime
            };
        }
        
        // ============== 计算可行域顶点 ==============
        function calculateVertices() {
            const constraints = getConstraints();
            const vertices = [];
            
            // 获取约束条件
            const mainMin = constraints.mainMinTime;
            const otherMin = constraints.otherMinTime;
            const maxSum = totalTime - (fixedActivities.exercise + fixedActivities.relax);
            
            // 考虑四条线的交点：x=mainMin, y=otherMin, x+y=maxSum, x=0, y=0
            
            // 添加 (mainMin, otherMin) 顶点
            if (mainMin + otherMin <= maxSum) {
                vertices.push([mainMin, otherMin]);
            }
            
            // 添加 (mainMin, maxSum-mainMin) 顶点
            if (maxSum - mainMin >= otherMin) {
                vertices.push([mainMin, maxSum - mainMin]);
            }
            
            // 添加 (maxSum-otherMin, otherMin) 顶点
            if (maxSum - otherMin >= mainMin) {
                vertices.push([maxSum - otherMin, otherMin]);
            }
            
            return vertices;
        }
        
        // ============== 寻找最优解 ==============
        function findOptimalSolution() {
            const vertices = calculateVertices();
            if (vertices.length === 0) {
                return null;
            }
            
            let optimalPoint = null;
            let maxValue = -Infinity;
            
            // 目标函数: Z = coefficients.main * x + coefficients.other * y + 固定活动的效益
            vertices.forEach(vertex => {
                const [x, y] = vertex;
                const value = coefficients.main * x + coefficients.other * y + 
                             coefficients.exercise * fixedActivities.exercise + 
                             coefficients.relax * fixedActivities.relax;
                
                if (value > maxValue) {
                    maxValue = value;
                    optimalPoint = {
                        x: x,
                        y: y,
                        value: value
                    };
                }
            });
            
            return optimalPoint;
        }
        
        // ============== 更新顶点列表 ==============
        function updateVerticesList() {
            const vertices = calculateVertices();
            const verticesGrid = document.getElementById('vertices-grid');
            const noVerticesMessage = document.getElementById('no-vertices-message');
            const verticesList = document.getElementById('vertices-list');
            
            // 清空现有内容
            verticesGrid.innerHTML = '';
            
            if (vertices.length === 0) {
                noVerticesMessage.style.display = 'block';
                verticesList.style.display = 'none';
                return;
            }
            
            noVerticesMessage.style.display = 'none';
            verticesList.style.display = 'block';
            
            // 计算每个顶点的目标函数值
            vertices.forEach((vertex, index) => {
                const [x, y] = vertex;
                const value = coefficients.main * x + coefficients.other * y + 
                              coefficients.exercise * fixedActivities.exercise + 
                              coefficients.relax * fixedActivities.relax;
                
                const vertexCard = document.createElement('div');
                vertexCard.style.padding = '10px';
                vertexCard.style.background = '#fff';
                vertexCard.style.borderRadius = '4px';
                vertexCard.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';
                
                vertexCard.innerHTML = `
                    <div style="font-weight: 500; margin-bottom: 5px;">顶点 ${index + 1}</div>
                    <div style="font-size: 13px; color: #666; margin-bottom: 3px;">主科 (x): ${x.toFixed(1)} 小时</div>
                    <div style="font-size: 13px; color: #666; margin-bottom: 3px;">综合 (y): ${y.toFixed(1)} 小时</div>
                    <div style="margin-top: 5px; font-weight: 500; color: #1890ff;">效益值: ${value.toFixed(1)}</div>
                `;
                
                verticesGrid.appendChild(vertexCard);
            });
        }
        
        // ============== 切换顶点显示 ==============
        function toggleVertex() {
            showVertices = !showVertices;
            const btnText = document.getElementById('vertex-btn-text');
            
            if (showVertices) {
                btnText.textContent = '隐藏顶点坐标';
                updateVerticesList();
            } else {
                btnText.textContent = '显示顶点坐标';
                document.getElementById('vertices-list').style.display = 'none';
            }
        }
        
        // ============== 智能缩放视图 ==============
        function autoZoom() {
            customZoom = true;
            
            // 获取约束条件
            const constraints = getConstraints();
            const mainMin = constraints.mainMinTime;
            const otherMin = constraints.otherMinTime;
            const maxSum = totalTime - (fixedActivities.exercise + fixedActivities.relax);
            
            // 设置合适的缩放因子
            zoomFactor.x = Math.max(mainMin, maxSum - otherMin) * 1.3;
            zoomFactor.y = Math.max(otherMin, maxSum - mainMin) * 1.3;
            
            // 确保最小缩放
            zoomFactor.x = Math.max(zoomFactor.x, 3);
            zoomFactor.y = Math.max(zoomFactor.y, 3);
            
            updateUI();
        }
        
        // ============== 重置视图 ==============
        function resetZoom() {
            customZoom = false;
            zoomFactor = { x: 4, y: 4 };
            updateUI();
        }
        
        // ============== 渲染图表 ==============
        function renderChart() {
            if (!myChart) {
                console.error("图表实例不存在，尝试重新初始化");
                initChart();
                if (!myChart) {
                    console.error("图表初始化失败");
                    return;
                }
            }
            
            try {
                const constraints = getConstraints();
                const mainMin = constraints.mainMinTime;
                const otherMin = constraints.otherMinTime;
                const maxSum = totalTime - (fixedActivities.exercise + fixedActivities.relax);
                
                // 计算顶点
                const vertices = calculateVertices();
                
                // 确定图表显示范围
                let xMax = customZoom ? zoomFactor.x : 4;
                let yMax = customZoom ? zoomFactor.y : 4;
                
                // 创建可行域多边形
                let polygonPoints = [];
                if (vertices.length > 0) {
                    // 按照逆时针或顺时针排序顶点
                    vertices.sort((a, b) => {
                        const angleA = Math.atan2(a[1] - otherMin, a[0] - mainMin);
                        const angleB = Math.atan2(b[1] - otherMin, b[0] - mainMin);
                        return angleA - angleB;
                    });
                    
                    polygonPoints = vertices.map(vertex => [vertex[0], vertex[1]]);
                }
                
                // 准备最优解数据（如果存在）
                let optimalSolution = null;
                let optimalValue = null;
                
                // 如果当前是步骤4或5，显示最优解
                if (currentActiveStep >= 4) {
                    const solution = findOptimalSolution();
                    if (solution) {
                        optimalSolution = [solution.x, solution.y];
                        optimalValue = solution.value;
                    }
                }
                
                // 创建目标函数等值线（如果在步骤4后）
                let objectiveLines = [];
                if (currentActiveStep >= 4 && optimalSolution) {
                    // 创建几条目标函数等值线
                    const optimalZ = coefficients.main * optimalSolution[0] + coefficients.other * optimalSolution[1];
                    const increment = optimalZ / 5;
                    
                    for (let i = 1; i <= 5; i++) {
                        const z = i * increment;
                        
                        // 计算等值线的两个点
                        // Z = mainCoeff * x + otherCoeff * y
                        // y = (Z - mainCoeff * x) / otherCoeff
                        // 取 x = 0 和 x = xMax 计算对应的 y
                        
                        // 避免除以零错误
                        if (coefficients.other === 0) continue;
                        
                        let y1 = (z - coefficients.main * 0) / coefficients.other;
                        let y2 = (z - coefficients.main * xMax) / coefficients.other;
                        
                        if (y1 >= 0 && y1 <= yMax && y2 >= 0 && y2 <= yMax) {
                            objectiveLines.push({
                                value: z.toFixed(1),
                                points: [[0, y1], [xMax, y2]]
                            });
                        }
                    }
                }
                
                // 配置图表选项
                const option = {
                    animation: false,
                    title: {
                        text: currentActiveStep >= 4 ? '线性规划可视化 - 最优解' : '线性规划可视化 - 可行域',
                        left: 'center',
                        top: 10,
                        textStyle: {
                            fontSize: 16,
                            fontWeight: 'normal'
                        }
                    },
                    tooltip: {
                        formatter: function(params) {
                            if (params.seriesName === '最优解') {
                                return '最优解: (' + params.data[0].toFixed(1) + ', ' + params.data[1].toFixed(1) + ')<br/>效益值: ' + (optimalValue ? optimalValue.toFixed(1) : '0.0');
                            } else if (params.seriesName === '顶点') {
                                return '顶点: (' + params.data[0].toFixed(1) + ', ' + params.data[1].toFixed(1) + ')';
                            }
                            return params.seriesName;
                        }
                    },
                    grid: {
                        left: '10%',
                        right: '10%',
                        top: 60,
                        bottom: 60
                    },
                    xAxis: {
                        type: 'value',
                        name: '主科时间 (小时)',
                        nameLocation: 'middle',
                        nameGap: 30,
                        min: 0,
                        max: xMax,
                        axisLine: {
                            lineStyle: { color: '#666' }
                        },
                        splitLine: {
                            show: true,
                            lineStyle: { type: 'dashed', color: '#ddd' }
                        }
                    },
                    yAxis: {
                        type: 'value',
                        name: '综合科目时间 (小时)',
                        nameLocation: 'middle',
                        nameGap: 30,
                        min: 0,
                        max: yMax,
                        axisLine: {
                            lineStyle: { color: '#666' }
                        },
                        splitLine: {
                            show: true,
                            lineStyle: { type: 'dashed', color: '#ddd' }
                        }
                    },
                    series: []
                };
                
                // 约束线 - 主科最小时间
                option.series.push({
                    name: '主科最小时间',
                    type: 'line',
                    symbolSize: 0,
                    lineStyle: { color: '#1890ff', width: 2 },
                    data: [[mainMin, 0], [mainMin, yMax]],
                    markArea: {
                        itemStyle: {
                            color: 'rgba(24, 144, 255, 0.1)',
                            borderWidth: 0
                        },
                        data: [
                            [{
                                coord: [mainMin, 0]
                            }, {
                                coord: [xMax, yMax]
                            }]
                        ]
                    }
                });
                
                // 约束线 - 综合科目最小时间
                option.series.push({
                    name: '综合科目最小时间',
                    type: 'line',
                    symbolSize: 0,
                    lineStyle: { color: '#52c41a', width: 2 },
                    data: [[0, otherMin], [xMax, otherMin]],
                    markArea: {
                        itemStyle: {
                            color: 'rgba(82, 196, 26, 0.1)',
                            borderWidth: 0
                        },
                        data: [
                            [{
                                coord: [0, otherMin]
                            }, {
                                coord: [xMax, yMax]
                            }]
                        ]
                    }
                });
                
                // 约束线 - 总时间限制
                option.series.push({
                    name: '总时间限制',
                    type: 'line',
                    symbolSize: 0,
                    lineStyle: { color: '#ff4d4f', width: 2 },
                    data: [[0, maxSum], [maxSum, 0]],
                    markArea: {
                        itemStyle: {
                            color: 'rgba(255, 77, 79, 0.1)',
                            borderWidth: 0
                        },
                        data: [
                            [{
                                coord: [0, 0]
                            }, {
                                coord: [xMax, maxSum]
                            }]
                        ]
                    }
                });
                
                // 可行域多边形（如果有顶点）
                if (polygonPoints.length > 0) {
                    option.series.push({
                        name: '可行域',
                        type: 'polygon',
                        emphasis: { disabled: true },
                        itemStyle: {
                            color: 'rgba(0, 200, 0, 0.2)',
                            borderColor: 'rgba(0, 200, 0, 0.8)',
                            borderWidth: 2
                        },
                        data: [polygonPoints]
                    });
                }
                
                // 顶点
                if (currentActiveStep >= 3 && showVertices && vertices.length > 0) {
                    option.series.push({
                        name: '顶点',
                        type: 'scatter',
                        symbolSize: 10,
                        itemStyle: { color: '#1890ff' },
                        data: vertices
                    });
                }
                
                // 如果有最优解，添加最优解点
                if (currentActiveStep >= 4 && optimalSolution) {
                    option.series.push({
                        name: '最优解',
                        type: 'scatter',
                        symbolSize: 15,
                        itemStyle: { color: '#ff4d4f' },
                        data: [optimalSolution]
                    });
                    
                    // 添加最优解标签
                    option.series.push({
                        name: '最优解标签',
                        type: 'scatter',
                        symbolSize: 0,
                        label: {
                            show: true,
                            position: 'top',
                            formatter: '最优解\n(' + optimalSolution[0].toFixed(1) + ', ' + optimalSolution[1].toFixed(1) + ')',
                            color: '#ff4d4f',
                            backgroundColor: 'rgba(255, 255, 255, 0.7)',
                            padding: 5,
                            borderRadius: 3
                        },
                        data: [optimalSolution]
                    });
                    
                    // 添加目标函数等值线
                    objectiveLines.forEach((line, index) => {
                        option.series.push({
                            name: '等值线 Z=' + line.value,
                            type: 'line',
                            symbolSize: 0,
                            lineStyle: { 
                                color: '#722ed1', 
                                width: index === objectiveLines.length - 1 ? 2 : 1,
                                type: index === objectiveLines.length - 1 ? 'solid' : 'dashed'
                            },
                            data: line.points
                        });
                    });
                }
                
                // 设置图表选项
                myChart.setOption(option, true);
                
            } catch (e) {
                console.error("渲染图表错误详情:", e);
                // 尝试简单图表渲染
                try {
                    myChart.setOption({
                        title: {
                            text: '图表渲染失败 - 简单图表',
                            left: 'center'
                        },
                        xAxis: {
                            type: 'value',
                            min: 0,
                            max: 5
                        },
                        yAxis: {
                            type: 'value',
                            min: 0,
                            max: 5
                        },
                        series: [{
                            data: [[1, 1]],
                            type: 'scatter'
                        }]
                    });
                } catch (fallbackError) {
                    console.error("简单图表也渲染失败:", fallbackError);
                }
            }
        }
        
        // ============== 步骤切换 ==============
        function switchStep(step) {
            // 隐藏所有步骤内容
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 显示选定步骤内容
            document.getElementById('step-content-' + step).classList.add('active');
            
            // 更新步骤按钮状态
            document.querySelectorAll('.step-button').forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                
                // 当前步骤为活动状态
                if (index + 1 === step) {
                    btn.classList.add('active');
                    btn.querySelector('.step-status').textContent = '进行中';
                } 
                // 之前步骤为完成状态
                else if (index + 1 < step) {
                    btn.classList.add('completed');
                    btn.querySelector('.step-status').textContent = '已完成';
                } 
                // 之后步骤为待完成状态
                else {
                    btn.querySelector('.step-status').textContent = '待完成';
                }
            });
            
            // 更新当前活动步骤
            currentActiveStep = step;
            
            // 更新UI
            updateUI();
        }
        
        // ============== 下一步 ==============
        function nextStep() {
            if (currentActiveStep < 5) {
                switchStep(currentActiveStep + 1);
            }
        }
        
        // ============== 上一步 ==============
        function prevStep() {
            if (currentActiveStep > 1) {
                switchStep(currentActiveStep - 1);
            }
        }
        
        // ============== 计算时间分配 ==============
        function calculateTimeAllocation() {
            const optimalSolution = findOptimalSolution();
            if (!optimalSolution) return null;
            
            return {
                main: optimalSolution.x.toFixed(1),
                other: optimalSolution.y.toFixed(1),
                exercise: fixedActivities.exercise.toFixed(1),
                relax: fixedActivities.relax.toFixed(1),
                total: (optimalSolution.x + optimalSolution.y + fixedActivities.exercise + fixedActivities.relax).toFixed(1),
                value: optimalSolution.value.toFixed(1)
            };
        }
        
        // ============== 更新时间分配图表 ==============
        function updateTimeAllocationChart() {
            try {
                const allocation = calculateTimeAllocation();
                if (!allocation) return;
                
                // 查找所有需要的元素
                const segmentMain = document.querySelector('.segment-main');
                const segmentOther = document.querySelector('.segment-other');
                const segmentExercise = document.querySelector('.segment-exercise');
                const segmentRelax = document.querySelector('.segment-relax');
                const totalValueElement = document.getElementById('total-value');
                
                // 如果任何元素不存在则退出
                if (!segmentMain || !segmentOther || !segmentExercise || !segmentRelax) {
                    console.error("无法找到时间条的所有段元素");
                    return;
                }
                
                // 计算每个活动的百分比宽度
                const totalWidth = 100;
                const mainWidth = (allocation.main / allocation.total) * totalWidth;
                const otherWidth = (allocation.other / allocation.total) * totalWidth;
                const exerciseWidth = (allocation.exercise / allocation.total) * totalWidth;
                const relaxWidth = (allocation.relax / allocation.total) * totalWidth;
                
                // 设置每个时间段的宽度
                segmentMain.style.width = mainWidth + '%';
                segmentOther.style.width = otherWidth + '%';
                segmentExercise.style.width = exerciseWidth + '%';
                segmentRelax.style.width = relaxWidth + '%';
                
                // 更新时间文本
                segmentMain.innerHTML = `${allocation.main}h`;
                segmentOther.innerHTML = `${allocation.other}h`;
                segmentExercise.innerHTML = `${allocation.exercise}h`;
                segmentRelax.innerHTML = `${allocation.relax}h`;
                
                // 更新总效益值
                if (totalValueElement) {
                    totalValueElement.textContent = allocation.value;
                }
            } catch (e) {
                console.error("更新时间分配图表错误:", e);
            }
        }
        
        // ============== 更新最优解显示 ==============
        function updateOptimalSolutionDisplay() {
            // 检查所需的DOM元素是否存在
            if (!document.getElementById('optimal-solution-card') || 
                !document.getElementById('no-solution-message') ||
                !document.getElementById('time-allocation-card')) {
                return;
            }
            
            const solution = findOptimalSolution();
            const optimalSolutionCard = document.getElementById('optimal-solution-card');
            const noSolutionMessage = document.getElementById('no-solution-message');
            const timeAllocationCard = document.getElementById('time-allocation-card');
            
            // 更新目标函数显示
            if (document.getElementById('optimal-function-text')) {
                document.getElementById('optimal-function-text').textContent = 
                    `${coefficients.main}x + ${coefficients.other}y + ${coefficients.exercise * fixedActivities.exercise + coefficients.relax * fixedActivities.relax}`;
            }
            
            // 如果没有解，显示无解消息
            if (!solution) {
                optimalSolutionCard.style.display = 'none';
                noSolutionMessage.style.display = 'block';
                timeAllocationCard.style.display = 'none';
                return;
            }
            
            // 显示最优解
            optimalSolutionCard.style.display = 'block';
            noSolutionMessage.style.display = 'none';
            timeAllocationCard.style.display = 'block';
            
            // 更新最优解坐标和效益值
            if (document.getElementById('optimal-x')) {
                document.getElementById('optimal-x').textContent = solution.x.toFixed(1);
            }
            if (document.getElementById('optimal-y')) {
                document.getElementById('optimal-y').textContent = solution.y.toFixed(1);
            }
            if (document.getElementById('optimal-value')) {
                document.getElementById('optimal-value').textContent = solution.value.toFixed(1);
            }
            
            // 更新时间分配显示
            if (document.getElementById('total-time-value')) {
                document.getElementById('total-time-value').textContent = totalTime.toFixed(1);
            }
            if (document.getElementById('main-time-value')) {
                document.getElementById('main-time-value').textContent = solution.x.toFixed(1) + '小时';
            }
            if (document.getElementById('other-time-value')) {
                document.getElementById('other-time-value').textContent = solution.y.toFixed(1) + '小时';
            }
            
            // 更新时间分配图表
            try {
                if (document.querySelector('.time-bar')) {
                    updateTimeAllocationChart();
                }
            } catch (e) {
                console.log("更新时间分配图表失败:", e);
            }
            
            // 不再自动调用 updateComparisonData
        }
        
        // ============== 标签页切换 ==============
        function switchTab(tabId) {
            console.log("切换到标签页:", tabId);
            // 更新标签按钮状态
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 激活选定的标签页
            document.querySelector(`.tab-button[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
            
            // 特殊处理：如果是方案对比标签页，更新对比数据
            if (tabId === 'compare') {
                setTimeout(() => {
                    try {
                        console.log("尝试更新比较数据...");
                        updateComparisonData();
                    } catch (e) {
                        console.error("更新比较数据时出错:", e);
                    }
                }, 100);
            }
            
            // 如果是自定义探索标签，需要检查总时间显示是否正确
            if (tabId === 'custom' && document.getElementById('total-time-custom-value')) {
                document.getElementById('total-time-custom-value').textContent = totalTime.toFixed(1);
            }
            
            // 如果是敏感性分析，则更新敏感性数据
            if (tabId === 'sensitivity' && document.getElementById('main-sensitivity-value')) {
                updateSensitivity('main', document.getElementById('main-sensitivity-value').textContent);
            }
            
            // 如果需要显示统计图表，在这里渲染不同的统计图
            if (tabId === 'compare') {
                setTimeout(() => {
                    renderStatisticsChart();
                }, 200);
            }
        }
        
        // ============== 渲染统计分析图表 ==============
        function renderStatisticsChart() {
            console.log("渲染统计分析图表...");
            const statisticsChart = document.getElementById('statistics-chart');
            if (!statisticsChart) {
                console.error("统计分析图表容器不存在");
                return;
            }
            
            try {
                // 检查是否已经有图表实例
                if (window.statsChart && window.statsChart.dispose) {
                    window.statsChart.dispose();
                }
                
                // 创建新图表实例
                window.statsChart = echarts.init(statisticsChart);
                
                // 获取最优解和平均分配方案
                const solution = findOptimalSolution();
                if (!solution) {
                    console.error("无法获取最优解，无法渲染统计图表");
                    return;
                }
                
                const maxSum = totalTime - (fixedActivities.exercise + fixedActivities.relax);
                const avgX = maxSum / 2;
                const avgY = maxSum / 2;
                const avgValue = coefficients.main * avgX + coefficients.other * avgY + 
                               coefficients.exercise * fixedActivities.exercise + 
                               coefficients.relax * fixedActivities.relax;
                
                // 设置图表选项
                const option = {
                    title: {
                        text: '方案效益对比',
                        left: 'center'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        },
                        formatter: function(params) {
                            const value = params[0].value;
                            return params[0].name + ': ' + value.toFixed(1) + '分';
                        }
                    },
                    legend: {
                        data: ['方案效益值'],
                        bottom: 0
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        top: '15%',
                        bottom: '15%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        data: ['最优方案', '平均分配']
                    },
                    yAxis: {
                        type: 'value',
                        name: '效益值'
                    },
                    series: [
                        {
                            name: '方案效益值',
                            type: 'bar',
                            data: [
                                {value: solution.value, itemStyle: {color: '#1890ff'}},
                                {value: avgValue, itemStyle: {color: '#52c41a'}}
                            ],
                            label: {
                                show: true,
                                position: 'top',
                                formatter: '{c} 分'
                            }
                        }
                    ]
                };
                
                // 设置图表
                window.statsChart.setOption(option);
                console.log("统计分析图表渲染完成");
                
            } catch (e) {
                console.error("渲染统计分析图表错误:", e);
            }
        }
        
        // ============== 更新方案对比数据 ==============
        function updateComparisonData() {
            try {
                console.log("更新方案对比数据...");
                // 强制检查所需的DOM元素是否存在，若不存在则直接返回
                if (!document.getElementById('optimal-x-compare')) {
                    console.error("找不到optimal-x-compare元素");
                    return;
                }
                if (!document.getElementById('optimal-y-compare')) {
                    console.error("找不到optimal-y-compare元素");
                    return;
                }
                if (!document.getElementById('optimal-value-compare')) {
                    console.error("找不到optimal-value-compare元素");
                    return;
                }
                if (!document.getElementById('average-x-compare')) {
                    console.error("找不到average-x-compare元素");
                    return;
                }
                if (!document.getElementById('average-y-compare')) {
                    console.error("找不到average-y-compare元素");
                    return;
                }
                if (!document.getElementById('average-value-compare')) {
                    console.error("找不到average-value-compare元素");
                    return;
                }
                if (!document.getElementById('improvement-percentage')) {
                    console.error("找不到improvement-percentage元素");
                    return;
                }
                
                // 获取最优解
                const optimalSolution = findOptimalSolution();
                if (!optimalSolution) {
                    console.error("无法获取最优解");
                    return;
                }
                
                // 更新最优方案数据
                document.getElementById('optimal-x-compare').textContent = optimalSolution.x.toFixed(1) + '小时';
                document.getElementById('optimal-y-compare').textContent = optimalSolution.y.toFixed(1) + '小时';
                document.getElementById('optimal-value-compare').textContent = optimalSolution.value.toFixed(1);
                
                // 计算平均方案数据
                const maxSum = totalTime - (fixedActivities.exercise + fixedActivities.relax);
                const avgX = maxSum / 2;
                const avgY = maxSum / 2;
                const avgValue = coefficients.main * avgX + coefficients.other * avgY + 
                               coefficients.exercise * fixedActivities.exercise + 
                               coefficients.relax * fixedActivities.relax;
                
                // 更新平均方案数据
                document.getElementById('average-x-compare').textContent = avgX.toFixed(1) + '小时';
                document.getElementById('average-y-compare').textContent = avgY.toFixed(1) + '小时';
                document.getElementById('average-value-compare').textContent = avgValue.toFixed(1);
                
                // 计算改进百分比
                const improvement = ((optimalSolution.value - avgValue) / avgValue) * 100;
                document.getElementById('improvement-percentage').textContent = improvement.toFixed(1) + '%';
                
                // 更新分析结果
                if (document.getElementById('compare-result')) {
                    let resultText = `通过线性规划找到的最优解比平均分配方案可以提高 ${improvement.toFixed(1)}% 的总效益值。`;
                    
                    if (improvement > 10) {
                        resultText += ' 这是一个显著的提升，表明数学优化在时间管理中非常有价值。';
                    } else if (improvement > 0) {
                        resultText += ' 虽然提升不大，但在长期学习中仍能带来明显的累积效益。';
                    } else {
                        resultText += ' 在当前参数设置下，最优解与平均分配方案差异不大。';
                    }
                    
                    document.getElementById('compare-result').innerHTML = resultText;
                }
                
                console.log("方案对比数据更新完成");
                
                // 渲染统计图表
                setTimeout(() => {
                    renderStatisticsChart();
                }, 100);
                
            } catch (e) {
                console.error("更新比较数据失败:", e);
            }
        }
        
        // ============== 页面加载时初始化 ==============
        window.onload = function() {
            try {
                document.getElementById('loading-overlay').style.display = 'flex';
                
                console.log("页面加载完成，开始初始化...");
                
                // 初始化图表
                let chartInitialized = initChart();
                if (!chartInitialized) {
                    console.error("图表初始化失败，将在3秒后重试");
                    setTimeout(() => {
                        console.log("重新尝试初始化图表...");
                        initChart();
                    }, 3000);
                }
                
                // 更新UI
                updateUI();
                
                // 设置默认值
                updateMainMinValue(1.5);
                updateOtherMinValue(1);
                
                // 更新效能系数图表
                updateEfficiencyBars();
                
                document.getElementById('loading-overlay').style.display = 'none';
                console.log("初始化完成");
            } catch (e) {
                console.error("初始化过程出错:", e);
                alert("初始化图表失败，请刷新页面重试");
                document.getElementById('loading-overlay').style.display = 'none';
            }
        };
        
        // ============== 更新敏感性分析 ==============
        function updateSensitivity(type, value) {
            // 保存当前系数
            const originalCoefficients = { ...coefficients };
            
            try {
                // 更新指定类型的系数
                coefficients[type] = parseInt(value);
                
                // 更新显示
                if (document.getElementById(type + '-sensitivity-value')) {
                    document.getElementById(type + '-sensitivity-value').textContent = value;
                }
                
                // 计算新的最优解
                const newSolution = findOptimalSolution();
                
                // 恢复原始系数
                coefficients = { ...originalCoefficients };
                
                // 更新敏感性分析结果
                if (!document.getElementById('sensitivity-result')) {
                    console.error("找不到sensitivity-result元素");
                    return;
                }
                
                let resultText = '';
                if (!newSolution) {
                    resultText = '使用当前系数值无法找到可行解。请尝试其他值或调整约束条件。';
                } else {
                    const originalSolution = findOptimalSolution();
                    
                    if (originalSolution.x.toFixed(1) === newSolution.x.toFixed(1) && 
                        originalSolution.y.toFixed(1) === newSolution.y.toFixed(1)) {
                        resultText = `将${type === 'main' ? '主科' : '综合科目'}效能系数调整为 ${value} 后，最优解位置不变，仍为 (${newSolution.x.toFixed(1)}, ${newSolution.y.toFixed(1)})。`;
                    } else {
                        resultText = `将${type === 'main' ? '主科' : '综合科目'}效能系数调整为 ${value} 后，最优解从 (${originalSolution.x.toFixed(1)}, ${originalSolution.y.toFixed(1)}) 变为 (${newSolution.x.toFixed(1)}, ${newSolution.y.toFixed(1)})。`;
                    }
                    
                    resultText += ` 总效益值从 ${originalSolution.value.toFixed(1)} 变为 ${newSolution.value.toFixed(1)}。`;
                    
                    // 计算是否有临界点
                    const ratio = coefficients.main / coefficients.other;
                    if (Math.abs(ratio - 1) < 0.1) {
                        resultText += ' 当前系数比接近 1:1，这是一个临界点，多个顶点可能有相同的效益值。';
                    }
                }
                
                document.getElementById('sensitivity-result').textContent = resultText;
            } catch (e) {
                console.error("更新敏感性分析错误:", e);
                // 恢复原始系数
                coefficients = { ...originalCoefficients };
            }
        }
        
        // ============== 更新总时间 ==============
        function updateTotalTime(value) {
            try {
                const customValue = parseFloat(value);
                if (document.getElementById('total-time-custom-value')) {
                    document.getElementById('total-time-custom-value').textContent = customValue.toFixed(1);
                }
            } catch (e) {
                console.error("更新总时间错误:", e);
            }
        }
        
        // ============== 更新主科自定义下限 ==============
        function updateMainSubjectCustom(value) {
            try {
                const customValue = parseFloat(value);
                
                // 更新UI元素
                if (document.getElementById('mainSubjectCustom')) {
                    document.getElementById('mainSubjectCustom').value = customValue;
                }
                if (document.getElementById('mainSubjectCustomInput')) {
                    document.getElementById('mainSubjectCustomInput').value = customValue;
                }
            } catch (e) {
                console.error("更新主科自定义下限错误:", e);
            }
        }
        
        // ============== 更新综合科目自定义下限 ==============
        function updateOtherSubjectCustom(value) {
            try {
                const customValue = parseFloat(value);
                
                // 更新UI元素
                if (document.getElementById('otherSubjectCustom')) {
                    document.getElementById('otherSubjectCustom').value = customValue;
                }
                if (document.getElementById('otherSubjectCustomInput')) {
                    document.getElementById('otherSubjectCustomInput').value = customValue;
                }
            } catch (e) {
                console.error("更新综合科目自定义下限错误:", e);
            }
        }
        
        // ============== 更新自定义探索 ==============
        function updateCustomExploration() {
            try {
                // 保存原始值
                const originalTotalTime = totalTime;
                
                // 获取自定义值
                if (!document.getElementById('total-time-custom-value') ||
                    !document.getElementById('mainSubject') ||
                    !document.getElementById('otherSubject') ||
                    !document.getElementById('mainSubjectCustom') ||
                    !document.getElementById('otherSubjectCustom') ||
                    !document.getElementById('custom-exploration-result')) {
                    console.error("自定义探索所需元素不存在");
                    return;
                }
                
                const originalMainMin = parseFloat(document.getElementById('mainSubject').value);
                const originalOtherMin = parseFloat(document.getElementById('otherSubject').value);
                const customTotalTime = parseFloat(document.getElementById('total-time-custom-value').textContent);
                const customMainMin = parseFloat(document.getElementById('mainSubjectCustom').value);
                const customOtherMin = parseFloat(document.getElementById('otherSubjectCustom').value);
                
                // 应用新值
                totalTime = customTotalTime;
                
                // 更新主科和综合科目最低时间
                updateMainSubject(customMainMin);
                updateOtherSubject(customOtherMin);
                
                // 计算新的最优解
                const newSolution = findOptimalSolution();
                
                // 更新探索结果
                let resultText = '';
                if (!newSolution) {
                    resultText = '使用当前参数设置无法找到可行解。请尝试其他值。';
                } else {
                    resultText = '使用当前参数设置，最优解为 (' + newSolution.x.toFixed(1) + ', ' + newSolution.y.toFixed(1) + ')，总效益值为 ' + newSolution.value.toFixed(1) + '。';
                    
                    if (customTotalTime > originalTotalTime) {
                        resultText += ' 增加总时间限制导致总效益值上升。';
                    } else if (customTotalTime < originalTotalTime) {
                        resultText += ' 减少总时间限制导致总效益值下降。';
                    }
                    
                    if (customMainMin > originalMainMin || customOtherMin > originalOtherMin) {
                        resultText += ' 提高最低时间要求通常会限制可行域，可能导致效益下降。';
                    }
                }
                
                document.getElementById('custom-exploration-result').innerHTML = '<p>' + resultText + '</p>';
                
                // 更新UI
                updateUI();
            } catch (e) {
                console.error("更新自定义探索错误:", e);
            }
        }
        
        // ============== 重置自定义探索 ==============
        function resetCustomExploration() {
            try {
                // 检查所需元素
                if (!document.getElementById('total-time-custom-value') ||
                    !document.getElementById('mainSubjectCustom') ||
                    !document.getElementById('mainSubjectCustomInput') ||
                    !document.getElementById('otherSubjectCustom') ||
                    !document.getElementById('otherSubjectCustomInput') ||
                    !document.getElementById('custom-exploration-result')) {
                    console.error("重置自定义探索所需元素不存在");
                    return;
                }
                
                // 重置为默认值
                totalTime = 4;
                document.getElementById('total-time-custom-value').textContent = '4.0';
                document.getElementById('mainSubjectCustom').value = 1.5;
                document.getElementById('mainSubjectCustomInput').value = 1.5;
                document.getElementById('otherSubjectCustom').value = 1.0;
                document.getElementById('otherSubjectCustomInput').value = 1.0;
                
                // 应用这些更改
                updateMainSubject(1.5);
                updateOtherSubject(1.0);
                
                // 更新UI
                updateUI();
                
                // 更新自定义探索结果
                document.getElementById('custom-exploration-result').innerHTML = `
                    <p>已重置为默认值，最优解已更新。</p>
                    <ul style="padding-left: 20px; margin-top: 10px;">
                        <li>增加总时间通常会提高总效益，但最优分配比例可能保持不变</li>
                        <li>如果某个约束条件不再起作用（非紧约束），最优解可能不会改变</li>
                        <li>当一个约束变得更严格时，总效益通常会降低</li>
                        <li>最优解总是出现在可行域的顶点上</li>
                    </ul>
                `;
            } catch (e) {
                console.error("重置自定义探索错误:", e);
            }
        }
    </script>
</body>
</html>

